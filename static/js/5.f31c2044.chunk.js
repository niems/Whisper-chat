(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{87:function(e,t){},94:function(e,t,n){"use strict";n.r(t);var a=n(90),s=n(7),l=n(8),r=n(11),i=n(9),c=n(10),o=n(3),u=n(0),h=n.n(u),m=n(61),p=n.n(m);var g=function(e,t,n){var a=p()(t,{query:{username:e}});return a.on("users.count",function(e){return console.log("current users online: ".concat(e,"\n"))}),a.on("users.all-online",function(e){n("all online users",e)}),a.on("users.add-online-user",function(e){n("add online user",e)}),a.on("users.remove-online-user",function(e){n("remove online user",e)}),a.on("user.receive-group-msg",function(e){n("new group message",e)}),a.on("user.receive-private-msg",function(e){n("new private message",e)}),{join:function(e){a.emit("user.join-channels",JSON.stringify(e),function(e){console.log("user.join-channels response: ".concat(e,"\n"))})},leave:function(e){a.emit("user.leave-channels",JSON.stringify(e),function(e){console.log("user.leave-channels response: ".concat(e,"\n"))})},sendGroupMsg:function(e){a.emit("user.send-group-msg",{channel:e.channel,msg:JSON.stringify(e)})},sendPrivateMsg:function(e){a.emit("user.send-private-msg",{sendTo:e.sendTo,msg:JSON.stringify(e.msg)})},close:function(){a.close()}}},d=n(12),f=n(6),b=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(r.a)(this,Object(i.a)(t).call(this,e))).logoutImgSrc=f.a.routePath+"assets/svg/placeholder/logout-black.svg",n.channelsViewImgSrc=f.a.routePath+"assets/svg/placeholder/list-view.svg",n}return Object(c.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return h.a.createElement("div",{className:"toolbar"},h.a.createElement("button",{id:"channels-view-list-btn",onClick:this.props.toggleChannelsDisplay},h.a.createElement("img",{src:this.channelsViewImgSrc,alt:"toggle channel list"})),h.a.createElement("span",{id:"current-user"},this.props.username),h.a.createElement("button",{id:"logout-btn",className:"link-to",onClick:this.props.signout},h.a.createElement("img",{src:this.logoutImgSrc,alt:"user logout"})))}}]),t}(u.PureComponent),C=function(e){function t(){return Object(s.a)(this,t),Object(r.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(c.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return h.a.createElement("li",{id:this.props.channel,className:"channel"},this.props.channel)}}]),t}(u.PureComponent),v=function(e){function t(){return Object(s.a)(this,t),Object(r.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(c.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return h.a.createElement(h.a.Fragment,null,h.a.createElement("h3",{id:"".concat(this.props.category,"-category"),className:"category-title"},this.props.category),h.a.createElement("ul",{id:"".concat(this.props.category,"-list"),className:"category-channels-list",onClick:this.props.onChannelSelect},this.props.channelList.map(function(e){return h.a.createElement(C,{key:e,channel:e})})))}}]),t}(u.PureComponent),O=function(e){var t=e.allChannels,n=e.allChannelRefs,a=e.onChannelSelect;return h.a.createElement("div",null,h.a.createElement("h2",{className:"category-section-header"},"Channels"),h.a.createElement("div",{className:"category-section"},h.a.createElement(v,{category:"Groups",displayCategoryTitle:!0,channelRef:n.Groups,onChannelSelect:a,channelList:t.Groups}),h.a.createElement(v,{category:"PMs",displayCategoryTitle:!0,channelRef:n.PMs,onChannelSelect:a,channelList:t.PMs})))},y=function(e){function t(){return Object(s.a)(this,t),Object(r.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(c.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return h.a.createElement("li",{id:this.props.username,"data-socketid":this.props.userId,className:"channel"},this.props.username)}}]),t}(u.PureComponent),j=function(e){function t(){return Object(s.a)(this,t),Object(r.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(c.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return h.a.createElement("ul",{id:"online-users-list",className:"category-channels-list",onClick:this.props.onUserSelect},Object.keys(this.props.userList).map(function(t){return h.a.createElement(y,{key:t,userId:e.props.userList[t].socketId,username:e.props.userList[t].username})}))}}]),t}(u.PureComponent),S=function(e){var t=e.channelRef,n=e.onUserSelect,a=e.userList;return h.a.createElement("div",null,h.a.createElement("h2",{className:"category-section-header"},"Online Users"),h.a.createElement("div",{className:"category-section"},h.a.createElement(j,{channelRef:t,onUserSelect:n,userList:a})))},k=function(e){function t(){return Object(s.a)(this,t),Object(r.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(c.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return h.a.createElement("section",{className:"side-panel"},h.a.createElement("nav",{id:"all-categories",className:"scrollbar"},h.a.createElement(O,{allChannels:this.props.allChannels,allChannelRefs:this.props.allChannelRefs,onChannelSelect:this.props.onChannelSelect}),h.a.createElement(S,{channelRef:this.props.allChannelRefs["Online Users"],onUserSelect:this.props.onChannelSelect,userList:this.props.allOnlineUsers})))}}]),t}(u.PureComponent),E=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(r.a)(this,Object(i.a)(t).call(this,e))).state={input:""},n.inputRef=h.a.createRef(),n.onChange=n.onChange.bind(Object(o.a)(Object(o.a)(n))),n.onSubmit=n.onSubmit.bind(Object(o.a)(Object(o.a)(n))),n}return Object(c.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.inputRef.current.focus()}},{key:"onChange",value:function(e){this.setState({input:e.target.value})}},{key:"onSubmit",value:function(e){e.preventDefault();if(/\S+/.test(this.state.input)){var t={category:this.props.category,channel:this.props.name,username:this.props.username,text:this.state.input,timestamp:(new Date).toUTCString()};this.setState({input:""}),this.props.sendNewMsg(t)}else console.log("invalid input")}},{key:"render",value:function(){return h.a.createElement("div",{id:"chat-input-container"},h.a.createElement("form",{id:"chat-input-form",onSubmit:this.onSubmit},h.a.createElement("input",{id:"chat-inputfield",className:"rounded-border",type:"text",value:this.state.input,placeholder:"Say something "+("Groups"===this.props.category?"in":"to")+" #".concat(this.props.name),onChange:this.onChange,ref:this.inputRef}),h.a.createElement("img",{className:"chat-submit",src:"./assets/svg/placeholder/round-arrow.svg",alt:"send button",onClick:this.onSubmit})))}}]),t}(u.PureComponent),M=function(e){return h.a.createElement(d.a.Consumer,null,function(t){var n=t.isUserAuthenticated;return h.a.createElement(E,Object.assign({},e,{username:n.username}))})},N=function(e){function t(){return Object(s.a)(this,t),Object(r.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(c.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return h.a.createElement("li",{className:"channel-msg"},h.a.createElement("img",{className:"avatar",src:"./assets/svg/user-icon.svg",alt:"user avatar"}),h.a.createElement("div",{className:"msg-container"},h.a.createElement("div",null,h.a.createElement("span",{className:"msg username"},this.props.msg.username),h.a.createElement("span",{className:"msg timestamp"},this.props.msg.timestamp)),h.a.createElement("p",{className:"msg text"},this.props.msg.text)))}}]),t}(u.PureComponent),w=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(r.a)(this,Object(i.a)(t).call(this,e))).scrollbarRef=h.a.createRef(),n}return Object(c.a)(t,e),Object(l.a)(t,[{key:"componentDidUpdate",value:function(){this.scrollbarRef.current.scrollTop=this.scrollbarRef.current.scrollHeight}},{key:"render",value:function(){return h.a.createElement("div",{id:"channel-messages-container",className:"scrollbar",ref:this.scrollbarRef},h.a.createElement("ul",{id:"channel-messages-list"},this.props.messages.map(function(e,t){return h.a.createElement(N,{key:t,msg:e})})))}}]),t}(u.Component),D=function(e){var t=e.channelInfo,n=e.sendNewMsg;return h.a.createElement("main",{id:"chat-view"},h.a.createElement("div",{id:"channel-title"},h.a.createElement("h1",null,"#".concat(t.name))),h.a.createElement(w,{messages:t.messages}),h.a.createElement(M,{category:t.category,name:t.name,sendNewMsg:n}))},U=n(60),R=function(){return h.a.createElement("section",{className:"wrapper center"},h.a.createElement("h1",null,"Signing out..."))},P=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(r.a)(this,Object(i.a)(t).call(this,e))).state={isSignoutComplete:!1},n}return Object(c.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;setTimeout(function(){e.setState({isSignoutComplete:!0})},2e3)}},{key:"render",value:function(){return this.state.isSignoutComplete?h.a.createElement(U.a,{to:f.a.routePath}):h.a.createElement(R,null)}}]),t}(u.PureComponent),T=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(r.a)(this,Object(i.a)(t).call(this,e))).allChannelData={Groups:{general:[{username:"BirdPerson",text:"In bird culture, this is considered a dick move",timestamp:(new Date).toUTCString()},{username:"Morty",text:"Ah jeez!",timestamp:(new Date).toUTCString()}],random:[{username:"ThatOneGuy",text:"Ayyyyy! ",timestamp:(new Date).toUTCString()}],listenHereGuy:[]},PMs:{Jerry:[{username:"Jerry",text:"Is this thing on?",timestamp:(new Date).toUTCString()}],BirdPerson:[{username:"BirdPerson",text:"You appear to be dying. I will make efforts to prevent this, but can promise nothing.",timestamp:(new Date).toUTCString()}]}},n.allChannelRefs={Groups:h.a.createRef(),PMs:h.a.createRef(),"Online Users":h.a.createRef()},n.onChannelSelect=n.onChannelSelect.bind(Object(o.a)(Object(o.a)(n))),n.addNewMsg=n.addNewMsg.bind(Object(o.a)(Object(o.a)(n))),n.createChannel=n.createChannel.bind(Object(o.a)(Object(o.a)(n))),n.deleteChannel=n.deleteChannel.bind(Object(o.a)(Object(o.a)(n))),n.addMsgToChannel=n.addMsgToChannel.bind(Object(o.a)(Object(o.a)(n))),n.updateSelectedChannelMessages=n.updateSelectedChannelMessages.bind(Object(o.a)(Object(o.a)(n))),n.updateAllChannels=n.updateAllChannels.bind(Object(o.a)(Object(o.a)(n))),n.updateOnlineUsers=n.updateOnlineUsers.bind(Object(o.a)(Object(o.a)(n))),n.socket=null,n.socketSetup=n.socketSetup.bind(Object(o.a)(Object(o.a)(n))),n.sendMsgToServer=n.sendMsgToServer.bind(Object(o.a)(Object(o.a)(n))),n.onMsgReceived=n.onMsgReceived.bind(Object(o.a)(Object(o.a)(n))),n.userSignout=n.userSignout.bind(Object(o.a)(Object(o.a)(n))),n.toggleChannelsDisplay=n.toggleChannelsDisplay.bind(Object(o.a)(Object(o.a)(n))),n.state={isSigningOut:!1,areChannelsDisplayed:!1,selectedChannel:{category:"Groups",name:"general",messages:n.allChannelData.Groups.general},allChannels:{Groups:Object.keys(n.allChannelData.Groups),PMs:Object.keys(n.allChannelData.PMs)},onlineUsers:{}},n}return Object(c.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.socketSetup()}},{key:"componentWillUnmount",value:function(){this.socket.close()}},{key:"onChannelSelect",value:function(e){if(e.preventDefault(),console.log("onChannelSelect()"),e.target.id!==this.state.selectedChannel.name&&e.currentTarget.id!==e.target.id){var t=e.currentTarget.id.replace("-list",""),n=e.target.id;console.log("\tcategory: ".concat(t)),console.log("\tchannel: ".concat(n,"\n")),"online-users"===t&&(t="PMs",console.log("\tdata id: ".concat(e.target.getAttribute("data-socketid"),"\n"))),0===this.state.selectedChannel.messages.length&&this.deleteChannel(this.state.selectedChannel.category,this.state.selectedChannel.name),this.createChannel(t,n);var a={category:t,name:n,messages:this.allChannelData[t][n]};this.setState({selectedChannel:a})}else console.log("same channel selected")}},{key:"addNewMsg",value:function(e){var t=e.category,n=e.channel;this.createChannel(t,n),this.addMsgToChannel(e),this.updateSelectedChannelMessages(n)}},{key:"createChannel",value:function(e,t){void 0===this.allChannelData[e][t]&&(this.allChannelData[e][t]=[],this.updateAllChannels(e,t))}},{key:"deleteChannel",value:function(e,t){delete this.allChannelData[e][t],this.updateAllChannels(e)}},{key:"addMsgToChannel",value:function(e){this.allChannelData[e.category][e.channel].push({username:e.username,text:e.text,timestamp:e.timestamp})}},{key:"updateSelectedChannelMessages",value:function(e){if(e===this.state.selectedChannel.name){var t=this.state.selectedChannel,n=this.state.selectedChannel,a=n.category,s=n.name;t.messages=this.allChannelData[a][s],this.setState({selectedChannel:t})}}},{key:"updateAllChannels",value:function(e){var t=Object(a.a)({},this.state.allChannels);this.isGroupMsg(e)?t.Groups=Object.keys(this.allChannelData.Groups):t.PMs=Object.keys(this.allChannelData.PMs),this.setState({allChannels:t})}},{key:"updateOnlineUsers",value:function(e){var t=Object(a.a)({},e);this.setState({onlineUsers:t})}},{key:"isGroupMsg",value:function(e){return"Groups"===e}},{key:"socketSetup",value:function(){var e=f.a.applicationServer;this.socket=g(this.props.username,e,this.onMsgReceived),this.socket.join(this.state.allChannels.Groups)}},{key:"sendMsgToServer",value:function(e){if(this.addNewMsg(e),console.log("sendMsgToServer() msg: ".concat(JSON.stringify(e),"\n")),this.isGroupMsg(e.category))this.socket.sendGroupMsg(e);else{var t=this.state.onlineUsers[e.channel];t?this.socket.sendPrivateMsg({sendTo:t.socketId,msg:e}):console.log("user offline")}}},{key:"onMsgReceived",value:function(e,t){if("new group message"===e)this.addNewMsg(JSON.parse(t));else if("new private message"===e)(t=JSON.parse(t)).channel=t.username,this.addNewMsg(t);else if("all online users"===e)this.updateOnlineUsers(t);else if("add online user"===e){var n=this.state.onlineUsers;n[t.username]=t,this.updateOnlineUsers(n)}else if("remove online user"===e){var a=this.state.onlineUsers;delete a[t],this.updateOnlineUsers(a)}}},{key:"userSignout",value:function(){this.props.signout(),this.setState({isSigningOut:!0})}},{key:"toggleChannelsDisplay",value:function(){console.log("toggleChannelsDisplay()"),this.setState(function(e){return{areChannelsDisplayed:!e.areChannelsDisplayed}})}},{key:"render",value:function(){return this.state.isSigningOut?h.a.createElement(P,null):h.a.createElement("article",{id:"profile"},h.a.createElement(b,{username:this.props.username,signout:this.userSignout,toggleChannelsDisplay:this.toggleChannelsDisplay}),h.a.createElement("div",{id:"profile-view"},this.state.areChannelsDisplayed?h.a.createElement(k,{allChannelRefs:this.allChannelRefs,allChannels:this.state.allChannels,allOnlineUsers:this.state.onlineUsers,onChannelSelect:this.onChannelSelect}):null,h.a.createElement(D,{channelInfo:this.state.selectedChannel,sendNewMsg:this.sendMsgToServer})))}}]),t}(u.Component);t.default=function(e){return h.a.createElement(d.a.Consumer,null,function(t){var n=t.isUserAuthenticated,a=t.signout;return h.a.createElement(T,Object.assign({},e,{username:n.username,signout:a}))})}}}]);
//# sourceMappingURL=5.f31c2044.chunk.js.map